# **************** <Tweek heading BEGIN do not edit this line> ****************
# Tweek
#
# -----------------------------------------------------------------
# File:          $RCSfile$
# Date modified: $Date$
# Version:       $Revision$
# -----------------------------------------------------------------
# **************** <Tweek heading END do not edit this line> ******************

# ************** <auto-copyright.pl BEGIN do not edit this line> **************
#
# VR Juggler is (C) Copyright 1998, 1999, 2000, 2001 by Iowa State University
#
# Original Authors:
#   Allen Bierbaum, Christopher Just,
#   Patrick Hartling, Kevin Meinert,
#   Carolina Cruz-Neira, Albert Baker
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Library General Public
# License as published by the Free Software Foundation; either
# version 2 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Library General Public License for more details.
#
# You should have received a copy of the GNU Library General Public
# License along with this library; if not, write to the
# Free Software Foundation, Inc., 59 Temple Place - Suite 330,
# Boston, MA 02111-1307, USA.
#
# *************** <auto-copyright.pl END do not edit this line> ***************

# -----------------------------------------------------------------------------
# Makefile.in for tweek/java.  It requires GNU make.
#
# Generated for use on @PLATFORM@
# -----------------------------------------------------------------------------

default: all

# Include common definitions.
include @topdir@/make.defs.mk

beandir			= $(bindir)/beans
srcdir			= @srcdir@
top_srcdir		= @top_srcdir@
EXTRA_SRCS_PATH		= $(srcdir)/../tweek/idl
EXTRA_JAVA_SRCS_PATH	= $(srcdir)/tweek
INSTALL			= @INSTALL@
INSTALL_FILES		=
JAVA_IDL_OPTS		= @JAVA_IDL_OPTS@ @JAVA_IDL_GENDIR_OPT@$(srcdir)
JAVA_IDL_INCLUDES	= @JAVA_IDL_INCFLAG@$(top_srcdir)

JDOM_JAR	= @JDOM_JAR@
OPENORB_JAR	= @OPENORB_JAR@
CLASSPATH	= $(JDOM_JAR)$(JCPS)$(OPENORB_JAR)

IDL_JAVA_FILES	= SubjectManager.java	\
                  Subject.java		\
                  Observer.java

#JAVA_SRCS   = $(shell find $(srcdir) -name '*.java')

JAVA_SRCS	= org/vrjuggler/tweek/Tweek.java			\
                  org/vrjuggler/tweek/net/CommException.java    	\
                  org/vrjuggler/tweek/beans/BeanRegistry.java \
                  org/vrjuggler/tweek/beans/XMLBeanFinder.java \
                  org/vrjuggler/tweek/services/EnvironmentService.java	\
                  org/vrjuggler/tweek/iconviewer/BeanIconViewer.java	\
                  org/vrjuggler/tweek/treeviewer/BeanTreeViewer.java	\
                  tweek/SubjectManagerHolder.java			\
                  tweek/SubjectHolder.java				\
                  tweek/ObserverHolder.java				\
                  tweek/ObserverPOA.java				\
                  tweek/SubjectManagerPackage/RegisteredSubjectHolder.java \
                  tweek/SubjectManagerPackage/SubjectListHolder.java

JARS		= Tweek.jar		\
                  TweekBeans.jar	\
                  TweekEvents.jar	\
                  TweekNet.jar		\
                  TweekServices.jar
BEANS		= Viewers

# For the following, *.class is used so that these variables may be used as
# dependencies of .jar targets.

TWEEK_CLASSES	= org/vrjuggler/tweek/*.class			\
                  org/vrjuggler/tweek/gui/*.class
TWEEK_EXTRAS	= org/vrjuggler/tweek/gui/*.gif

BEANS_MF	= $(srcdir)/beans.MF
BEANS_CLASSES	= org/vrjuggler/tweek/beans/*.class		\
                  org/vrjuggler/tweek/beans/loader/*.class

NET_CLASSES	= org/vrjuggler/tweek/net/*.class		\
                  org/vrjuggler/tweek/net/corba/*.class		\
                  tweek/*.class					\
                  tweek/SubjectManagerPackage/*.class

EVENT_CLASSES	= org/vrjuggler/tweek/event/*.class

SERVICE_MF	= $(srcdir)/services.MF
SERVICE_CLASSES	= org/vrjuggler/tweek/services/*.class

VIEWERS_MF	= $(srcdir)/viewers.MF
VIEWERS_CLASSES	= org/vrjuggler/tweek/iconviewer/*.class	\
                  org/vrjuggler/tweek/treeviewer/*.class
VIEWERS_EXTRAS	= org/vrjuggler/tweek/iconviewer/*.gif

# List the packages for which JavaDoc documentation will be generated.
BASE_PKG	= org.vrjuggler.tweek
DOC_PKGS	= $(BASE_PKG)			\
                  $(BASE_PKG).gui		\
                  $(BASE_PKG).net		\
                  $(BASE_PKG).beans		\
                  $(BASE_PKG).beans.loader	\
                  $(BASE_PKG).event		\
                  $(BASE_PKG).services		\
                  $(BASE_PKG).iconviewer	\
                  $(BASE_PKG).treeviewer

webroot		= $(HOME)/public_html/phpjug
instdir		= tweek/1.0
doc_prefix	= $(webroot)/$(instdir)
DOC_ROOT	= programmer.reference.java

include $(MKPATH)/dpp.obj.mk

# -----------------------------------------------------------------------------
# Extra targets.
# -----------------------------------------------------------------------------
jars: $(JARS) $(addsuffix .jar, $(BEANS))
ifdef GLOBAL_BUILD
	@$(MKINSTALLDIRS) $(top_srcdir)/bin
	cp $(JARS) $(addsuffix .jar, $(BEANS)) $(top_srcdir)/bin
endif

Subject.java: Subject.idl
	$(JAVA_IDL) $(JAVA_IDL_OPTS) -noskel $(JAVA_IDL_INCLUDES) $<

SubjectManager.java: SubjectManager.idl
	$(JAVA_IDL) $(JAVA_IDL_OPTS) -noskel $(JAVA_IDL_INCLUDES) $<

Tweek.jar: $(TWEEK_CLASSES)
	$(JAR) cvf $@ $(TWEEK_CLASSES)
	cd $(srcdir) && $(JAR) uvf $(topdir)/java/$@ $(TWEEK_EXTRAS)

TweekNet.jar: $(NET_CLASSES)
	$(JAR) cvf $@ $(NET_CLASSES)

TweekBeans.jar: $(BEANS_MF) $(BEANS_CLASSES)
	$(JAR) cvfm $@ $(BEANS_MF) $(BEANS_CLASSES)

TweekEvents.jar: $(EVENT_CLASSES)
	$(JAR) cvf $@ $(EVENT_CLASSES)

TweekServices.jar: $(SERVICE_CLASSES)
	$(JAR) cvfm $@ $(SERVICE_MF) $(SERVICE_CLASSES)

Viewers.jar: $(VIEWERS_CLASSES)
	$(JAR) cvfm $@ $(VIEWERS_MF) $(VIEWERS_CLASSES)
	cd $(srcdir) && $(JAR) uvf $(topdir)/java/$@ $(VIEWERS_EXTRAS)

docs:
	$(JDK_HOME)/bin/javadoc -d $(DOC_ROOT) -sourcepath $(srcdir)	\
          -classpath $(CLASSPATH) $(DOC_PKGS)

links:
	$(SHELL) $(MKINSTALLDIRS) $(instlinks)/bin/beans
	cd $(instlinks)/bin && rm -f ./*.jar
	cd $(instlinks)/bin &&						\
          for jar in $(JARS) ;						\
          do								\
              $(LN_S) $(topdir)/java/$$jar ./ ;				\
          done
	cd $(instlinks)/bin/beans && rm -f *.jar *.xml
	cd $(instlinks)/bin/beans &&					\
          for bean in $(BEANS) ;					\
          do								\
              $(LN_S) $(topdir)/java/$$bean.jar ./ ;			\
              $(LN_S) $(TWEEKROOT_ABS)/java/$$bean.xml ./ ;		\
          done
	cd $(instlinks)/bin &&						\
          for jar in `echo "$(JDOM_JAR)" | sed -e 's/$(JCPS)/ /g'` ;	\
          do								\
              $(LN_S) $$jar ./ ;					\
          done
	cd $(instlinks)/bin &&						\
          for jar in `echo "$(OPENORB_JAR)" | sed -e 's/$(JCPS)/ /g'` ;	\
          do								\
              $(LN_S) $$jar ./ ;					\
          done
	cd $(instlinks)/bin && rm -f ./tweek &&				\
          $(LN_S) $(TWEEKROOT_ABS)/java/tweek.sh ./tweek
	cd $(instlinks)/bin && rm -f ./tweek-base.sh &&			\
          $(LN_S) $(topdir)/java/tweek-base.sh ./
	cd $(instlinks)/bin && rm -f ./java.security.policy.txt &&	\
          $(LN_S) $(TWEEKROOT_ABS)/java/java.security.policy.txt ./

# This cannot be named 'install' because Doozer++ already defines that.
tweek-install:
	@echo "------------------------------------------------"
	@echo "Installing the Tweek Java code base"
	@echo "------------------------------------------------"
ifeq (@OS_TYPE@, UNIX)
	$(INSTALL) -m $(EXEC_PERMS) $(GROUP_OPT_UNIX)			\
          $(TWEEKROOT_ABS)/java/tweek.sh $(bindir)/tweek
	$(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)			\
          $(topdir)/java/tweek-base.sh $(bindir)/tweek-base.sh
else
	$(INSTALL) -m $(EXEC_PERMS) $(GROUP_OPT_UNIX)			\
          $(TWEEKROOT_ABS)/java/tweek.bat $(bindir)/tweek.bat
endif	# if OS_TYPE == UNIX
	$(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)			\
          $(top_srcdir)/java/java.security.policy.txt $(bindir)
	for jar in $(JARS) ;						\
          do								\
              $(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)		\
                $(topdir)/java/$$jar $(bindir) ;			\
          done
	for bean in $(BEANS) ;						\
          do								\
              $(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)		\
                $(topdir)/java/$$bean.jar $(beandir) ;			\
              $(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)		\
                $(top_srcdir)/java/$$bean.xml $(beandir) ;		\
          done
	for jar in `echo "$(JDOM_JAR)" | sed -e 's/$(JCPS)/ /g'` ;	\
          do								\
              $(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)		\
                $$jar $(bindir) ;					\
          done
	for jar in `echo "$(OPENORB_JAR)" | sed -e 's/$(JCPS)/ /g'` ;	\
          do								\
              $(INSTALL) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)		\
                $$jar $(bindir) ;					\
          done

install-docs:
	$(MKINSTALLDIRS) $(doc_prefix)
	rm -rf $(doc_prefix)/$(DOC_ROOT)
	mv $(DOC_ROOT) $(doc_prefix)

CLEAN_FILES	+= $(JARS) $(TWEEK_CLASSES) $(BEANS_CLASSES)		\
                   $(NET_CLASSES) $(EVENT_CLASSES) $(SERVICE_CLASSES)	\
                   $(VIEWERS_CLASSES)
CLEAN_DIRS	+= tweek $(srcdir)/tweek

ifdef GLOBAL_BUILD
    CLEAN_DIRS	+= $(top_srcdir)/bin
endif

include Makefile.inc
