# **************** <Tweek heading BEGIN do not edit this line> ****************
# Tweek
#
# -----------------------------------------------------------------
# File:          $RCSfile$
# Date modified: $Date$
# Version:       $Revision$
# -----------------------------------------------------------------
# **************** <Tweek heading END do not edit this line> ******************

# ************** <auto-copyright.pl BEGIN do not edit this line> **************
#
# VR Juggler is (C) Copyright 1998, 1999, 2000, 2001 by Iowa State University
#
# Original Authors:
#   Allen Bierbaum, Christopher Just,
#   Patrick Hartling, Kevin Meinert,
#   Carolina Cruz-Neira, Albert Baker
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Library General Public
# License as published by the Free Software Foundation; either
# version 2 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Library General Public License for more details.
#
# You should have received a copy of the GNU Library General Public
# License along with this library; if not, write to the
# Free Software Foundation, Inc., 59 Temple Place - Suite 330,
# Boston, MA 02111-1307, USA.
#
# *************** <auto-copyright.pl END do not edit this line> ***************

# -----------------------------------------------------------------------------
# Makefile.in for tweek/java.  It requires GNU make.
#
# Generated for use on @PLATFORM@
# -----------------------------------------------------------------------------

default: all

# Include common definitions.
include @topdir@/make.defs.mk

beandir=		$(bindir)/beans
srcdir=			@srcdir@
top_srcdir=		@top_srcdir@
EXTRA_SRCS_PATH=	$(srcdir)/../tweek/idl
EXTRA_JAVA_SRCS_PATH=	$(srcdir)/tweek
INSTALL=		@INSTALL@
INSTALL_FILES=		
JAVA_IDL_OPTS=		@JAVA_IDL_OPTS@ @JAVA_IDL_GENDIR_OPT@$(srcdir)
JAVA_IDL_INCLUDES=	@JAVA_IDL_INCFLAG@$(top_srcdir)

JDOM_JAR=	@JDOM_JAR@
JAVA_ORB_JAR=	@JAVA_ORB_JAR@

# The following check is done this way to prevent unwanted spaces from
# appearing in $(CLASSPATH)
ifneq ($(JAVA_ORB_JAR), none)
CLASSPATH=	$(JDOM_JAR)$(JCPS)$(JAVA_ORB_JAR)
else
CLASSPATH=	$(JDOM_JAR)
endif

IDL_JAVA_FILES=	SubjectManager.java	\
		Subject.java		\
		Observer.java

#JAVA_SRCS=	$(shell find $(srcdir) -name '*.java')

TWEEK_PKG=		org.vrjuggler.tweek
TWEEK_DIR=		$(subst .,/,$(TWEEK_PKG))
TWEEK_SRCS=		$(patsubst $(srcdir)/%,%,$(wildcard $(srcdir)/$(TWEEK_DIR)/*.java))
TWEEK_CLASSES=		$(TWEEK_SRCS:.java=.class)

BEANS_PKG=		org.vrjuggler.tweek.beans
BEANS_DIR=		$(subst .,/,$(BEANS_PKG))
BEANS_SRCS=		$(patsubst $(srcdir)/%,%,$(wildcard $(srcdir)/$(BEANS_DIR)/*.java))
BEANS_CLASSES=		$(BEANS_SRCS:.java=.class)

LOADER_PKG=		org.vrjuggler.tweek.beans.loader
LOADER_DIR=		$(subst .,/,$(LOADER_PKG))
LOADER_SRCS=		$(patsubst $(srcdir)/%,%,$(wildcard $(srcdir)/$(LOADER_DIR)/*.java))
LOADER_CLASSES=		$(LOADER_SRCS:.java=.class)

EVENT_PKG=		org.vrjuggler.tweek.event
EVENT_DIR=		$(subst .,/,$(EVENT_PKG))
EVENT_SRCS=		$(patsubst $(srcdir)/%,%,$(wildcard $(srcdir)/$(EVENT_DIR)/*.java))
EVENT_CLASSES=		$(EVENT_SRCS:.java=.class)

GUI_PKG=		org.vrjuggler.tweek.gui
GUI_DIR=		$(subst .,/,$(GUI_PKG))
GUI_SRCS=		$(patsubst $(srcdir)/%,%,$(wildcard $(srcdir)/$(GUI_DIR)/*.java))
GUI_CLASSES=		$(GUI_SRCS:.java=.class)

ICONVIEWER_PKG=		org.vrjuggler.tweek.iconviewer
ICONVIEWER_DIR=		$(subst .,/,$(ICONVIEWER_PKG))
ICONVIEWER_SRCS=	$(patsubst $(srcdir)/%,%,$(wildcard $(srcdir)/$(ICONVIEWER_DIR)/*.java))
ICONVIEWER_CLASSES=	$(ICONVIEWER_SRCS:.java=.class)

NET_PKG=		org.vrjuggler.tweek.net
NET_DIR=		$(subst .,/,$(NET_PKG))
NET_SRCS=		$(patsubst $(srcdir)/%,%,$(wildcard $(srcdir)/$(NET_DIR)/*.java))
NET_CLASSES=		$(NET_SRCS:.java=.class)

CORBA_PKG=		org.vrjuggler.tweek.net.corba
CORBA_DIR=		$(subst .,/,$(CORBA_PKG))
CORBA_SRCS=		$(patsubst $(srcdir)/%,%,$(wildcard $(srcdir)/$(CORBA_DIR)/*.java))
CORBA_CLASSES=		$(CORBA_SRCS:.java=.class)

SERVICES_PKG=		org.vrjuggler.tweek.services
SERVICES_DIR=		$(subst .,/,$(SERVICES_PKG))
SERVICES_SRCS=		$(patsubst $(srcdir)/%,%,$(wildcard $(srcdir)/$(SERVICES_DIR)/*.java))
SERVICES_CLASSES=	$(SERVICES_SRCS:.java=.class)

TEXT_PKG=		org.vrjuggler.tweek.text
TEXT_DIR=		$(subst .,/,$(TEXT_PKG))
TEXT_SRCS=		$(patsubst $(srcdir)/%,%,$(wildcard $(srcdir)/$(TEXT_DIR)/*.java))
TEXT_CLASSES=		$(TEXT_SRCS:.java=.class)

TREEVIEWER_PKG=		org.vrjuggler.tweek.treeviewer
TREEVIEWER_DIR=		$(subst .,/,$(TREEVIEWER_PKG))
TREEVIEWER_SRCS=	$(patsubst $(srcdir)/%,%,$(wildcard $(srcdir)/$(TREEVIEWER_DIR)/*.java))
TREEVIEWER_CLASSES=	$(TREEVIEWER_SRCS:.java=.class)

TWEEK_AUTO_SRCS=							\
	tweek/SubjectManagerHolder.java					\
	tweek/SubjectHolder.java					\
	tweek/ObserverHolder.java					\
	tweek/ObserverPOA.java						\
	tweek/SubjectManagerPackage/RegisteredSubjectHolder.java	\
	tweek/SubjectManagerPackage/SubjectListHolder.java

JAVA_SRCS=			\
	$(TWEEK_SRCS)		\
	$(BEANS_SRCS)		\
	$(LOADER_SRCS)		\
	$(EVENT_SRCS)		\
	$(GUI_SRCS)		\
	$(ICONVIEWER_SRCS)	\
	$(NET_SRCS)		\
	$(CORBA_SRCS)		\
	$(SERVICES_SRCS)	\
	$(TEXT_SRCS)		\
	$(TREEVIEWER_SRCS)	\
	$(TWEEK_AUTO_SRCS)

JAVA_CLASSES=	$(JAVA_SRCS:.java=.class)

JARS=		Tweek.jar		\
		TweekBeans.jar		\
		TweekEvents.jar		\
		TweekNet.jar		\
		TweekServices.jar
BEANS=		Viewers

# Some of our jars need custom manifests
BEANS_MF=	$(srcdir)/beans.MF
SERVICES_MF=	$(srcdir)/services.MF
VIEWERS_MF=	$(srcdir)/viewers.MF

include $(MKPATH)/dpp.obj.mk

# -----------------------------------------------------------------------------
# Extra targets.
# -----------------------------------------------------------------------------
jars: $(JARS) $(addsuffix .jar, $(BEANS))
ifdef GLOBAL_BUILD
	@$(MKINSTALLDIRS) $(top_srcdir)/bin
	@$(MKINSTALLDIRS) $(top_srcdir)/bin/beans
ifneq ($(JARS), )
	cp $(JARS) $(top_srcdir)/bin
endif
ifneq ($(BEANS), )
	cp $(addsuffix .jar, $(BEANS)) $(top_srcdir)/bin/beans
endif
endif

Subject.java: Subject.idl
	$(JAVA_IDL) $(JAVA_IDL_OPTS) -noskel $(JAVA_IDL_INCLUDES) $<

SubjectManager.java: SubjectManager.idl
	$(JAVA_IDL) $(JAVA_IDL_OPTS) -noskel $(JAVA_IDL_INCLUDES) $<

Tweek.jar: $(TWEEK_CLASSES) $(GUI_CLASSES) $(TEXT_CLASSES)
	$(JAR) cvf $@ \
		$(TWEEK_DIR)/*.class \
		$(GUI_DIR)/*.class \
		$(TEXT_DIR)/*.class
	cd $(srcdir) && $(JAR) uvf $(topdir)/java/$@ \
		$(GUI_DIR)/*.gif \
		$(TEXT_DIR)/*.gif \
		LICENSE-java-laf.txt

TweekBeans.jar: $(BEANS_MF) $(BEANS_CLASSES) $(LOADER_CLASSES)
	$(JAR) cvfm $@ $(BEANS_MF) \
		$(BEANS_DIR)/*.class \
		$(LOADER_DIR)/*.class

TweekEvents.jar: $(EVENT_CLASSES)
	$(JAR) cvf $@ \
		$(EVENT_DIR)/*.class

TweekNet.jar: $(NET_CLASSES) $(CORBA_CLASSES) tweek/*.class tweek/SubjectManagerPackage/*.class
	$(JAR) cvf $@ \
		$(NET_DIR)/*.class \
		$(CORBA_DIR)/*.class \
		tweek/*.class \
		tweek/SubjectManagerPackage/*.class

TweekServices.jar: $(SERVICES_CLASSES)
	$(JAR) cvfm $@ $(SERVICES_MF) \
		$(SERVICES_DIR)/*.class

Viewers.jar: $(ICONVIEWER_CLASSES) $(TREEVIEWER_CLASSES)
	$(JAR) cvfm $@ $(VIEWERS_MF) \
		$(ICONVIEWER_DIR)/*.class \
		$(TREEVIEWER_DIR)/*.class
	cd $(srcdir) && $(JAR) uvf $(topdir)/java/$@ \
		$(ICONVIEWER_DIR)/*.gif \
		LICENSE-java-laf.txt

links:
	$(SHELL) $(MKINSTALLDIRS) $(instlinks)/bin/beans
	cd $(instlinks)/bin &&						\
          for jar in $(JARS) ;						\
          do								\
              rm -f ./$$jar ;						\
              $(LN_S) $(topdir)/java/$$jar ./ ;				\
          done
	cd $(instlinks)/bin/beans &&					\
          for bean in $(BEANS) ;					\
          do								\
              rm -f ./$$bean.jar ./$$bean.xml ;				\
              $(LN_S) $(topdir)/java/$$bean.jar ./ ;			\
              $(LN_S) $(TWEEKROOT_ABS)/java/$$bean.xml ./ ;		\
          done
	cd $(instlinks)/bin &&						\
          for jar in `echo "$(JDOM_JAR)" | sed -e 's/$(JCPS)/ /g'` ;	\
          do								\
              rm -f `basename $$jar` ;					\
              $(LN_S) $$jar ./ ;					\
          done
ifneq ($(JAVA_ORB_JAR), none)
	cd $(instlinks)/bin &&						\
          for jar in `echo "$(JAVA_ORB_JAR)" | sed -e 's/$(JCPS)/ /g'` ; \
          do								\
              rm -f `basename $$jar` ;					\
              $(LN_S) $$jar ./ ;					\
          done
endif
	cd $(instlinks)/bin && rm -f ./tweek &&				\
          $(LN_S) $(TWEEKROOT_ABS)/java/tweek.sh ./tweek
	cd $(instlinks)/bin && rm -f ./tweek-base.sh &&			\
          $(LN_S) $(topdir)/java/tweek-base.sh ./
	cd $(instlinks)/bin && rm -f ./java.security.policy.txt &&	\
          $(LN_S) $(TWEEKROOT_ABS)/java/java.security.policy.txt ./

# This cannot be named 'install' because Doozer++ already defines that.
tweek-install:
	@echo "------------------------------------------------"
	@echo "Installing the Tweek Java code base"
	@echo "------------------------------------------------"
ifeq (@OS_TYPE@, UNIX)
	$(INSTALL) $(SYMLINK) -m $(EXEC_PERMS) $(GROUP_OPT_UNIX)	\
          $(TWEEKROOT_ABS)/java/tweek.sh $(bindir)/tweek
	$(INSTALL) $(SYMLINK) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)	\
          $(topdir)/java/tweek-base.sh $(bindir)/tweek-base.sh
else
	$(INSTALL) $(SYMLINK) -m $(EXEC_PERMS) $(GROUP_OPT_UNIX)	\
          $(TWEEKROOT_ABS)/java/tweek.bat $(bindir)/tweek.bat
endif	# if OS_TYPE == UNIX
	$(INSTALL) $(SYMLINK) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)	\
          $(top_srcdir)/java/java.security.policy.txt $(bindir)
	for jar in $(JARS) ;						\
          do								\
              $(INSTALL) $(SYMLINK) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)	\
                $(topdir)/java/$$jar $(bindir) ;			\
          done
	for bean in $(BEANS) ;						\
          do								\
              $(INSTALL) $(SYMLINK) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)	\
                $(topdir)/java/$$bean.jar $(beandir) ;			\
              $(INSTALL) $(SYMLINK) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)	\
                $(top_srcdir)/java/$$bean.xml $(beandir) ;		\
          done
	for jar in `echo "$(JDOM_JAR)" | sed -e 's/$(JCPS)/ /g'` ;	\
          do								\
              $(INSTALL) $(SYMLINK) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)	\
                $$jar $(bindir) ;					\
          done
ifneq ($(JAVA_ORB_JAR), none)
	for jar in `echo "$(JAVA_ORB_JAR)" | sed -e 's/$(JCPS)/ /g'` ;	\
          do								\
              $(INSTALL) $(SYMLINK) -m $(FILE_PERMS) $(GROUP_OPT_UNIX)	\
                $$jar $(bindir) ;					\
          done
endif

CLEAN_FILES+=	$(JARS) $(addsuffix .jar, $(BEANS)) $(JAVA_CLASSES)
CLEAN_DIRS+=	tweek $(srcdir)/tweek

ifdef GLOBAL_BUILD
   CLEAN_DIRS+=	$(top_srcdir)/bin
endif

include Makefile.inc
