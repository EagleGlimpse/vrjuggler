default: run

# Basic options.
srcdir			= @srcdir@
JAVAC_FLAGS		= -classpath "$(CLASSPATH)" -sourcepath "$(srcdir)" -d .
JAVA_IDL_OPTS		= @JAVA_IDL_OPTS@ @JAVA_IDL_GENDIR_OPT@$(srcdir)
JAVA_IDL_INCLUDES	= @JAVA_IDL_INCFLAG@$(TWEEK_BASE_DIR)/include
JCPS			= @JCPS@

JDOM_JAR		= @JDOM_JAR@
OPENORB_JAR		= @OPENORB_JAR@
JUNIT_JAR		= /home/users/patrick/src/Juggler/junit3.7/junit.jar
TWEEK_JARS		= $(TWEEK_BASE_DIR)/bin/TweekServices.jar$(JCPS)$(TWEEK_BASE_DIR)/bin/TweekNet.jar$(JCPS)$(TWEEK_BASE_DIR)/bin/TweekEvents.jar$(JCPS)$(TWEEK_BASE_DIR)/bin/TweekBeans.jar

CLASSPATH		= $(JDOM_JAR)$(JCPS)$(JUNIT_JAR)$(JCPS)$(TWEEK_JARS)$(JCPS)$(OPENORB_JAR)

# Commands to execute.
JAVA_COMPILE		= @JAVAC@ $(JAVAC_FLAGS)
JAVA_IDL		= @APP_JAVA_IDL@
JAR			= @JAR@

VPATH		= @srcdir@:@srcdir@/tweektest:@srcdir@/tweek:$(TWEEK_BASE_DIR)/include/tweek/idl

#IDL_JAVA_FILES	=

CLASSES		= AllTests.class

# -----------------------------------------------------------------------------
# Application build targets.
# -----------------------------------------------------------------------------
all:
#	$(MAKE) java_idl
	$(MAKE) java

run: AllTests.class
	java -classpath "$(CLASSPATH)$(JCPS)." AllTests

java_idl: $(IDL_JAVA_FILES)

java: $(CLASSES)

install:
	cp NetworkTestBean.jar $(TWEEK_BASE_DIR)/bin/beans
	cp $(srcdir)/NetworkTestBean.xml $(TWEEK_BASE_DIR)/bin/beans

# Suffix rules for building object files.
.SUFFIXES: .java .class .idl

.java.class:
	$(JAVA_COMPILE) $<

.idl.java:
	$(JAVA_IDL) $(JAVA_IDL_OPTS) $(JAVA_IDL_INCLUDES) $<

AllTests.class: tweektest/*.class

# -----------------------------------------------------------------------------
# Clean-up targets.
# -----------------------------------------------------------------------------
clean:
	rm -f Makedepend *.@OBJEXT@ tweektest.ilk  so_locations *.?db	\
          core* $(addprefix $(srcdir)/tweektest/, $(IDL_JAVA_FILES))
	rm -rf ii_files $(srcdir)/tweek

clobber:
	@$(MAKE) clean
	rm -f server@EXEEXT@ 
