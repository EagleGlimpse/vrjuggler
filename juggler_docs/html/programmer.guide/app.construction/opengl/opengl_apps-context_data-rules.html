<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>OpenGL App Interface</title>
<!-- install-web block-ignore-begin -->
<link rel="stylesheet" type="text/css" href="../../../../style/base_style.css">
<!-- install-web block-ignore-end -->
</head>

<body>

<h2>Using context specific data</h2>
<p>The VR Juggler OpenGL graphics system is a complex multi-headed beast.&nbsp;
Luckily developers do not have to understand how the system is working to use it
correct.&nbsp; As long as you subscribe to several simple rules for allocating
and using context data, everything should work fine in you application.</p>
<p>This section describes these allocation and usage rules, but does not
describe the rationale behind the rules. If you would like the details of why
these rules should be followed, please read the next section that goes into much
more (excruciating) detail.</p>
<h3>On to the rules...</h3>

<p>Now you know how to make a context specific data member and how to use it in
a draw function (you just treat it like a pointer), but how and where should you
allocate context specific data.&nbsp; For example, if I want to create display list where should I allocate the
display list and store it to the context specific data variable.</p>

<h3>Rule 1: Don't allocate context data in draw()</h3>

<p>You should not allocate context data in the draw() function.&nbsp;&nbsp; There are many reasons, but the primary one is that you would be
testing for allocate way too many times and at incorrect times.&nbsp; There are
better places to allocate context data.</p>

<h3>Rule 2: Initialize (static) context data in contextInit()</h3>

<p>The place to allocate static context specific data is in the vjGlApp::contextInit() function.</p>

<p>&quot;Static&quot; context data means context data that does not change
during the application's execute.&nbsp; An example of static context data would
be a display list to render an object model that is preloaded by the application
and never changes.&nbsp; It is static because the display list only has to be
generated once for each context and the application can generate the display
list as soon as the application starts execution.</p>

<p>The contextInit() function is called immediately after creation of any new OpenGL contexts (ie.
it is called whenever new windows open) and is called with the newly created
context active. This function is the
perfect place to allocate static context data because it is only called when we have a
new context that we need to prepare for (and also because that is what it is
designed for).</p>

<p>For example...</p>

<pre>void userApp::contextInit()
{
   // Allocate context specific data
   (*mDispListId) = glGenLists(1);

   glNewList((*mDispListId), GL_COMPILE);
      glScalef(0.50f, 0.50f, 0.50f);
      // Call func that draws a cube in OpenGL
      drawCube();
   glEndList();
   ...
}</pre>

<p>This function shows the normal way that display lists should be allocated in
VR Juggler.&nbsp; Just allocate the display list, store it to a context specific
data member, and then fill the display list.</p>

<p>Texture objects and other context specific data are created in exactly the same
way.&nbsp;</p>

<h3>Rule 3: Allocate and update dynamic context data in contextPreDraw()</h3>

<p>The place to allocate dynamic context specific data is in the contextPreDraw() function.</p>

<p>&quot;Dynamic&quot; context data differs from static context data in that
dynamic data may change during the application's execution. An example of
dynamic data would be a display list for rendering an object from an application
data set that changes as the applications executes.&nbsp; This requires dynamic
context data because the display list has to be regenerated every time the
application changes the data set.</p>

<p>Applications such as this make it necessary to allocate (or change) context
data dynamically during an applications execution.</p>
<p>Say for example that they user has requested the application to load a new
data file.&nbsp; After the data is loaded you want to put the drawing functions
into a new display list that will be used to draw the data.</p>
<p>You can't use <tt>vjGlApp::contextInit()</tt> because it is only called when
a new context is created.&nbsp; In this case, a new window has not been
created.&nbsp; What we really want is just a callback that is called once per
context so that we can add and change the context specific data.</p>
<p>That is what contextPreDraw() does.&nbsp; It is called once per context for
each VR Juggler frame with the current context active.&nbsp; You can add code
here that edits the context specific data dynamically in any way that you would
like.</p>
<p>Please notice though that since this function is called so often and is
called in highly performance critical areas, you should not do much work in this
function.&nbsp; Any time taken by this function, directly decreases the draw
performance of the application.&nbsp; In most cases, I recommend trying to make
the function have a very simple early exit clause such as the following.&nbsp;
This makes the average cost only that of a single comparison operation.</p>
<pre>userApp::contextInit()
{
   if(have work to do)
   {
     // Do it
   }
}</pre>

</body>

</html>
