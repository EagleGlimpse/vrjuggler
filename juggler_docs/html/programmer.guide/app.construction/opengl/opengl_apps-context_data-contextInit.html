<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>OpenGL App Interface</title>
<!-- <link rel="stylesheet" type="text/css" href="../../../../style/base_style.css"> -->
</head>

<body>

<h3>How do applications allocate context data?</h3>
<p>Now you know how to make a context specific data member and how to use it in
a draw function (you just treat it like a pointer), but how and where should you
allocate context specific data.</p>

<p>For example, if I want to create display list where should I allocate the
display list and store it to the context specific data variable.</p>

<h3>Don't allocate context data in draw()</h3>

<p>First off, why should you not allocate a display list in the <tt>vjGlApp::draw()</tt>
function.&nbsp; There are many reasons, but the primary one is that you would be
testing for allocate way too many times.</p>

<p>The draw function is called for each surface, for each eye, every
frame.&nbsp; But you only need to allocate context data when a new window is
open.&nbsp; Okay, you may also want to dynamically allocate display lists while
the app is running, but I will cover that case in a little bit.</p>

<p>Just remember, don't allocate display lists, texture objects, or any other
context data in the <tt>vjGlApp::draw()</tt> function.&nbsp; It is just bad.</p>

<h3>contextInit() - The place to initialize context data</h3>

<p>The place to allocate context specific data is in the vjGlApp::contextInit() function.&nbsp;
This function is called immediately after creation of any new OpenGL contexts (ie.
it is called whenever new windows open) and is called with the newly created
context active. This function is the
perfect place to allocate context data because it is only called when we have a
new context that we need to prepare for (and also because that is what it is
designed for).</p>

<p>For example...</p>

<pre>void userApp::contextInit()
{
   // Allocate context specific data
   (*mDispListId) = glGenLists(1);

   glNewList((*mDispListId), GL_COMPILE);
      glScalef(0.50f, 0.50f, 0.50f);
      // Call func that draws a cube in OpenGL
      drawCube();
   glEndList();
   ...
}</pre>

<p>This function shows the normal way that display lists should be allocated in
VR Juggler.&nbsp; Just allocate the display list, store it to a context specific
data member, and then fill the display list.</p>

<p>Texture objects and other context specific data are created in the same
way.&nbsp;</p>

<h3>contextPreDraw() - The place to update context data</h3>

<p>There is one other case where you may want to create context specific data
items such as display lists.&nbsp; It may be necessary to allocate (or change)
new display lists dynamically as the application is running.</p>
<p>Say for example that they user has requested the application to load a new
data file.&nbsp; After the data is loaded you want to put the drawing functions
into a new display list that will be used to draw the data.</p>
<p>You can't use <tt>vjGlApp::contextInit()</tt> because it is only called when
a new context is created.&nbsp; In this case, a new window has not been
created.&nbsp; What we really want is just a callback that is called once per
context so that we can add and change the context specific data.</p>
<p>That is what contextPreDraw() does.&nbsp; It is called once per context for
each VR Juggler frame with the current context active.&nbsp; You can add code
here that edits the context specific data dynamically in any way that you would
like.</p>
<p>Please notice though that since this function is called so often and is
called in highly performance critical areas, you should not do much work in this
function.&nbsp; Any time taken by this function, directly decreases the draw
performance of the application.&nbsp; In most cases, I recommend trying to make
the function have a very simple early exit clause such as the following.&nbsp;
This makes the average cost only that of a single comparison operation.</p>
<pre>userApp::contextInit()
{
   if(have work to do)
   {
     // Do it
   }
}</pre>

</body>

</html>
