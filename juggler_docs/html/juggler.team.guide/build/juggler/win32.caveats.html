<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/loose.dtd">

<HEAD>
<TITLE>Win32 Build Caveats</TITLE>
</HEAD>

<BODY>

<H2>Win32 Compiling and Development Issues</H2>

<!-- install-web toc-begin -->
<H3>Table of Contents:</H3>

  <OL>
    <LI><A HREF="#intro">Introduction</A>
    <LI><A HREF="#tools">Necessary Tools</A>
    <LI><A HREF="#env">Environment Variables</A>
    <LI><A HREF="#compile">Compiling Juggler</A>
    <LI><A HREF="#problems">Known Problems</A>
  </OL>
<!-- install-web toc-end -->

<H3><A NAME="intro">Introduction</A></H3>

  <P>
    When VR Juggler was first ported to the Win32 environment, a Microsoft
    Visual C++ project file was used for compiling the library.  Development
    on the GNU Autoconf-based build system on UNIX platforms had been going
    strong for a long time prior to this, and it was quickly realized that
    having two separate methods for compiling would complicate matters.  The
    build system used for compiling VR Juggler is now the same on UNIX and
    Win32 platforms.  Only the Autoconf-based system is supported which
    provides the same build environment on all platforms.
  </P>

  <P>
    Since the UNIX and Win32 environments have many striking differences,
    special information must be provided for using the Juggler build system
    on Windows-based platforms.  This document provides all the information
    necessary for getting set up in a Win32 environment prior to compiling
    and installing Juggler for developmental use.  This is intended
    primarily for developers who wish to work with the Juggler source and
    (hopefully) submit work to the Juggler team.  Users who are doing
    application development on a Win32 platform may want to read it too
    so that they may get a better understanding of what is available as
    part of the Win32 support.
  </P>

<H3><A NAME="tools">Necessary Tools</A></H3>

  <P>
    Developers should refer to the Win32 section of the
    <A HREF="${DOWNLOAD}/">download page</A> for the list of packages that
    must be installed.  The <TT>juggler-tools</TT> package is especially
    important.  It contains exactly the utilities used for compiling Juggler
    (aside from Visual C++ of course) including some modified versions of
    programs.  Of note, the version of <TT>make</TT> included is what comes
    with the Bamboo Win32 tools.  It is a modified version of GNU make that
    will run in a DOS shell and can handle DOS-style paths.  Also,
    <TT>makedepend</TT> has been modified to output UNIX-safe paths and to
    know about the <TT>INCLUDE</TT> environment variable used by Visual C++.
  </P>

  <P>
    In addition to what is listed on the download page, the following
    packages are needed for Win32 development of Juggler (but not for
    application development):
  </P>

    <UL>
      <LI>
        <A TARGET="_blank" HREF="${GETCYGWIN}">Cygwin</A> 1.1.8 or newer.
        Version B20.1 is also known to work, but that version has many
        problems.  In particular, the version of <TT>make</TT> distributed
        with B20.1 will not work in a DOS shell.  With the newer versions
        of Cygwin, the tools work better in the Win32 environment, and
        many pre-compiled packages are available including CVS, Perl,
        Autoconf, and Automake.  It is strongly recommended that the Cygwin
        versions of all these utilities be used.
      </LI>
      <LI>
        <A TARGET="_blank" HREF="${GETAUTOCONF}">GNU Autoconf</A> version
        2.13 and <A TARGET="_blank" HREF="${GETAUTOMAKE}">GNU Automake</A>
        version 1.4 or newer.  This is needed to compile a new configure
        script after modifying <TT>configure.in</TT> and to update
        <TT>vjDefines.h.in</TT> when necessary.  Note that these tools can
        only be run from a BASH shell (included with the Cygwin package).
        Autoconf and Automake can be compiled and installed on a Win32
        platform without modification using the Cygwin tools.
      </LI>
    </UL>

<H3><A NAME="env">Environment Variables</A></H3>

  <P>
    There are several environment variables that need to be set properly
    when compiling and installing Juggler and when running Juggler
    applications.  These variables apply to all users, both those who are
    compiling and running applications as well as those who are compiling
    Juggler itself.
  </P>

    <DL>
      <DT><TT>%PATH%</TT>
        <DD>All users must have the <TT>juggler-tools</TT> directory in
            their path.  If the Cygwin utilities are installed, it is
            especially important that <TT>juggler-tools</TT> be listed
            <I>before</I> the Cygwin <TT>bin</TT> directory so that the
            supported utilities are found first.  Unfortunately, when
            running a BASH shell, the Cygwin path is always first, but in
            the BASH environment, this is acceptable.  The ordering is
            far more important for DOS shells.  Besides
            <TT>juggler-tools</TT>, the directory containing the Visual
            C++ executables must also be in the path.  The configure script
            needs this so that it can find <TT>CL.EXE</TT> when it is
            setting up the C and C++ compilers.
      <DT><TT>%INCLUDE%</TT>
        <DD>This should also be set for all users.  It provides paths to
            the Visual C++ include directories that <TT>CL.EXE</TT> needs
            when compiling.  On Windows NT, it is set only for the user
            who installed Visual C++.  Be sure to change this to be
            included in <I>all</I> users' environments.  Alternatively, it
            can be set using the <TT>VCVARS32.BAT</TT> batch file on a
            per-shell basis, but users will see much better results if it
            is set in the general environment.  In particular, a BASH shell
            does not get the environment changes made by the batch file.
            The batch file also uses ``8.3'' names which may confuse the
            Cygwin tools.
      <DT><TT>%LIB%</TT>
        <DD>This is another Visual C++ environment variable that needs to
            be set in the same manner as <TT>%INCLUDE%</TT>.  Again, this is
            initially set only for the user who installed Visual C++ and
            should be changed so that it is set for all users.
      <DT><TT>%VJ_BASE_DIR%</TT>
        <DD>The value for this should be set using the DOS path with
            <TT>/</TT>'s as the path separator rather than <TT>\</TT>'s
            as would normally be the case with DOS/Win32 paths.  It just
            simplifies things all around to use a UNIX-style path in this
            case.
    </DL>

<H3><A NAME="compile">Compiling Juggler</A></H3>

  <P>
    Finally, the actual process of compiling (and installing) Juggler can
    begin.  After taking the steps in the preceding sections, this will be
    an easy task (assuming that the source is stable of course).  This
    section focuses primarily on the process when done within a DOS shell.
    In a BASH shell, the environment is almost identical to that on a UNIX
    platform, so there are no special considerations to be made.
  </P>

  <P>
    The first step, as usual, is to configure the build environment with
    the configure script.  (This assumes that <TT>configure</TT> and
    <TT>vjDefines.h.in</TT> have already been generated.)  If running in a
    DOS shell, <TT>configure</TT> must be invoked using the <TT>sh</TT>
    utility.  The following will <I>not</I> work:
  </P>

<PRE>
    % <B>./configure [options]</B>
</PRE>

  <P>
    Instead, it must be run as:
  </P>

<PRE>
    % <B>sh ./configure [options]</B>
</PRE>

  <P>
    As with the UNIX environment, it can be run from a separate build
    directory.  Refer to the
    <A HREF="${TEAMGUIDE}/build/juggler/use.configure.html">configuration
    documentation</A> for more information (specifically, the subsection
    titled ``Advanced Use'' in the ``Usage'' section).  As mentioned in
    the 
    <A HREF="${TEAMGUIDE}/build/juggler/use.configure.html">configuration
    documentation</A>, options with paths should use <TT>/</TT>'s for the
    path separator rather than <TT>\</TT>'s.  They should also be enclosed
    in double quotes (<TT>"path/to/something"</TT>) in case the path
    includes one or more spaces.
  </P>

  <P>
    Once configuration has completed, compiling can be done in either a DOS
    shell or a BASH shell using the version of GNU make in
    <TT>juggler-tools</TT>.  <I>The Cygwin B20.1 version will not work in a
    DOS shell.</I>  This is when it is especially important to have the
    <TT>juggler-tools</TT> directory before the Cygwin directory in the
    user's path.
  </P>

  <P>
    Beyond this, everything (aside from the problems listed in
    <A HREF="#problems">the next section</A>) will be the same as in a
    UNIX environment.
  </P>

<H3><A NAME="problems">Known Problems</A></H3>

  <P>
    Listed here are things to keep in mind when working in a Win32
    environment.  It is not as stable as its UNIX counterpart due, for the
    most part, to reasons beyond the control of this project.  Please read
    this in full before reporting problems with the Win32 build.
  </P>

    <UL>
      <LI>
        In versions of Cygwin prior to 1.1, the UNIX utilities will appear
        to become blocked or may die with an error saying that they cannot
        fork.  This may have been due to a race condition in the old Cygwin
        code.  Typically, it happens when one or more BASH shells are open
        while a build is happening in a DOS shell.  Closing one or more
        (sometimes all) of the BASH shells usually fixes the problem.  It
        is strongly recommended that developers update to
        <A HREF="${GETCYGWIN}">Cygwin 1.1.8</A> and to the
        <A HREF="${PUB}/juggler-tools-1.1.zip">latest <TT>juggler-tools</TT>
        package</A>.
      </LI>
      <LI>
        The ``developer installation'' does not work in any Win32 file
        system.  It relies heavily on symbolic links which, while common
        on UNIX file systems, have no meaning in a Win32 environment.
        Because of this, Juggler must be fully installed after it has been
        compiled (refer to the
        <A HREF="${TEAMGUIDE}/build/juggler/use.install.html">installation
        documentation</A> for more information on this process).  Once
        that is done, <TT>$VJ_BASE_DIR</TT> can be set to point to the
        installation directory and development can continue in the build
        tree.
      </LI>
      <LI>
        The configure script assumes that the compiler knows how to find
        the OpenGL libraries and headers.  No check is (yet) made to
        verify that they are in a reachable location.  This will hopefully
        change at some point.
      </LI>
      <LI>
        Dependencies must be generated differently than on UNIX-based
        platforms.  The Visual C++ compiler does not output the
        dependencies of a given source file in the same manner as all
        UNIX C and C++ compilers supported by the Juggler build system.
        Because of this, <TT>makedepend</TT> is used.  It may not handle
        all the <TT>#ifdef</TT>'s properly and report non-fatal warnings.
        These can be ignored typically, especially if it is trying to find 
        some file that is clearly UNIX-specific (e.g., <TT>pthread.h</TT>).
        The version of <TT>makedepend</TT> in <TT>juggler-tools</TT> has
        been modified to output UNIX-style (and UNIX-safe) paths, but it
        is possible that not all situations have been considered.  If it is
        clear that <TT>makedepend</TT> is not handling a path properly,
        please <A HREF="${BUGS}/bugs.html">report the problem</A>.
      </LI>
      <LI>
        A configure script generated in a Win32 environment will not work
        in a UNIX environment.  The ``^M problem'' causes the shell to
        fail when trying to run the script.  A configure script generated
        in a UNIX environment will however work in a Win32 environment
        because <TT>sh</TT> can handle both UNIX- and DOS-style newlines.
      </LI>
      <LI>
        The application makefiles (<I>not</I> the library makefiles) all
        use the <TT>$(VAR_NAME)</TT> syntax for referencing variables.
        This is so that the makefiles will work with <TT>nmake</TT>.  These
        are intended to be usable with all version of <TT>make</TT> (or as
        many as is feasibly possible), so they deviate from the style used
        in other makefiles to accommodate this particular version of
        <TT>make</TT>.
      </LI>
    </UL>

</BODY>
