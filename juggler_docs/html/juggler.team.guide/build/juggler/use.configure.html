<HEAD>
<TITLE>Using the Configure Script</TITLE>
</HEAD>

<BODY>
<H2>Using the VR Juggler Configure Script</H2>

<H3>Table of Contents:</H3>

  <OL>
    <LI><A HREF="#intro">Introduction</A>
    <LI><A HREF="#recommend">Recommended Reading</A>
    <LI><A HREF="#autoconf">Autoconf and Autoheader</A>
    <LI><A HREF="#usage">Usage</A>
    <LI><A HREF="#template">Template (<TT>.in</TT>) Files</A>
  </OL>

<A NAME="intro"><H4>Introduction</H4></A>

  <P>
    The VR Juggler project uses the autoconf utility to stay portable across
    platforms.  This means you will have to ``configure'' the project before
    compiling it.  To make sense of this documentation, please understand
    the concepts listed in <A HREF="#required">Required Reading</A>.
    Posting about these subjects to the mailing list will probably be
    ignored.
  </P>

  <P>
    In this file, the following conventions are used for text formatting
    and naming:

    <UL>
      <LI>
        Program, file and directory names are written in <TT>fixed-width
        font</TT>.
      </LI>
      <LI>
        Commands that are intended to be run by the user are written in
        <TT><B>bold fixed-width font</B></TT>.
      </LI>
      <LI>
        References to system and library calls are written as
        <I>call_name</I>(##) where ``##'' is the manual section where that
        call's documentation can be found.
      </LI>
      <LI>
        Environment variables are named as <TT>ENV_VAR_NAME</TT>.  (This is
        to avoid confusion between UNIX and Win32 environments where
        environment variables are evaluated using <TT>$</TT>'s and
        <TT>%</TT>'s respectively.)
      </LI>
    </UL>

  </P>

<A NAME="recommend"><H4>Recommended Reading:</H4></A>

  <UL>
    <LI>
      <A HREF="http://www.gnu.org/software/autoconf/autoconf.html">Autoconf</A>
      documentation (try doing a <TT>man</TT> or <TT>info</TT> on
      `autoconf')</A>
    </LI>
    <LI>
      <A HREF="http://www.gnu.org/software/make/make.html">GNU make</A>
      documentation (try doing a <TT>man</TT> or <TT>info</TT> on `gmake' or
      on `make'; there also is a good book by
      <A HREF="http://www.ora.com/">O'Reilly &amp; Associates</A>)
    </LI>
  </UL>

<A NAME="autoconf"><H4>Autoconf and Autoheader</H4></A>

  <P>
    VR Juggler uses tools from the GNU Autoconf package for automatically
    generating its configure script and its template configuration header
    file (<TT>vjDefines.h</TT>).  The command <TT>autoconf</TT> is used to
    ``compile'' the file <TT>configure.in</TT> in the top-level directory
    into the configure script, aptly named <TT>configure</TT>.
    <TT>autoheader</TT> reads <I>both</I> <TT>configure.in</TT> and
    <TT>acconfig.h</TT> to generate the template file <TT>vjDefines.h.in</TT>
    which the configure script later uses to generate <TT>vjDefines.h</TT>.
  </P>

  <P>
    It is important that the generated files remain synchronized with their
    templates for proper compiling of the library.  To facilitate this,
    revision numbers of <TT>configure.in</TT> and <TT>acconfig.h</TT> are
    available at the tops of the files, and these can be compared against
    the revision number of <TT>configure</TT> and <TT>vjDefines.h.in</TT>.
    If the numbers do not match, it is best to run <TT>autoconf</TT> and/or
    <TT>autoheader</TT> to get everything up to date.  Typically,
    <TT>autoconf</TT> needs to be used far more frequently than
    <TT>autoheader</TT>, but there are times when changes made only to
    <TT>configure.in</TT> require that both be run.  It hurts nothing to
    run both whenever <TT>configure.in</TT> is updated.
  </P>

  <P>
    Note that it is possible to use a configure script generated on a
    UNIX platform in a Win32 environment.  The version of <TT>sh.exe</TT>
    distributed in <TT>juggler-tools.zip</TT> handles the UNIX newline 
    characters.  It is, however, not possible to use a configure script
    generated in a Win32 environment on a UNIX platform.  The <TT>^M</TT>
    characters confuse the shell and cause the script to fail immediately.
  </P>

<A NAME="usage"><H4>Usage</H4></A>

  <H5>Environment Variables (UNIX vs. Win32)</H5>

    <P>
      In a UNIX environment, no environment variables have to be set for
      <TT>configure</TT> to work properly.  The <TT>PATH</TT> should be
      reasonable and must include tools such as C and C++ compilers, a
      working GNU make and standard UNIX utilities such as <TT>cat</TT>,
      <TT>sh</TT>, <TT>test</TT>, etc.  The configuration process can of
      course uses environment variables such as <TT>CC</TT>, <TT>CXX</TT>,
      <TT>CFLAGS</TT>, etc. as it runs.  Users can define values for these
      variables to force the configuration process to use user-defined
      settings.  This is common in configure script use.
    </P>

    <P>
      In a Win32 environment, some variables have to be defined for the
      Microsoft Visual C++ compiler to work properly.  These are mentioned
      on the <A HREF="${DOWNLOAD}/">Download page</A>.  Refer to that
      document to ensure that the environment is set up right for building
      and installing.
    </P>

  <H5>Quick Start</H5>

    <P>
      The easiest way to configure Juggler is to run <TT>configure</TT>
      with no options in the top-level source directory.  Doing this will
      root compiling in this directory.  This will use all the default
      values for the host platform with the script doing its best to make
      the right choices.  In some cases, however, this may not be sufficient.
    </P>

    <P>
      Possible situations that may cause <TT>configure</TT> to report a
      fatal error or a warning about a feature being disabled include the
      following:

      <UL>
        <LI>
          The version of <TT>sh</TT> available does not support the features
          being used in <TT>configure</TT>.  In this case, the configure
          script will exit with an error status.  To get around this,
          invoke <TT>ksh</TT>, <TT>bash</TT> or <TT>zsh</TT> on
          <TT>configure</TT> (in that order as available).  These shells
          have newer features and fully support <TT>sh</TT> syntax.  (In
          particular, this is known to be a problem with <TT>/bin/sh</TT>
          on Solaris 7.)
        </LI>
        <LI>
          A ``modern'' C++ compiler was not found.  <B>This is a fatal
          error.</B>  VR Juggler uses many features of the latest C++
          standard, and a C++ compiler supporting these features is
          absolutely required.  To use an alternate C++ compiler, specify
          a value for the environment variable <TT>CXX</TT>.
        </LI>
        <LI>
          The OpenGL libraries and/or header files were not found.  <B>This
          is a fatal error.</B>  To remedy this problem, use the
          <TT>--with-oglroot</TT> option to <TT>configure</TT> to specify the
          root directory containing the GL installation.
        </LI>
        <LI>
          The Performer libraries and/or header files were not found.  This
          is not a fatal error and simply causes the Performer API to be
          disabled for that build.  If Performer is available, use the
          <TT>--with-pfroot</TT> option to <TT>configure</TT> to specify the
          root directory containing the Performer installation.
        </LI>
        <LI>
          A version of Perl greater than or equal to 5.004 was not found.
          <B>This will cause compiling of <TT>vjcontrol</TT> and
          installation of the library to fail.</B>  To provide a valid Perl
          binary for use by the makefiles, use the <TT>--with-perl</TT>
          option to <TT>configure</TT>.  The path given should be the full
          path up to but <I>not</I> including the <TT>perl</TT> binary
          itself.  For example, if a <TT>perl5</TT> binary were in
          <TT>/usr/unsupported/bin</TT>, give this directory as the argument
          to <TT>--with-perl</TT>.  In a Win32 environment, use <TT>/</TT>'s
          as the path separator rather than <TT>\</TT>'s.
        </LI>
        <LI>
          No Java compiler was found.  This disables the compilation of
          <TT>vjcontrol</TT>.  There are three ways to fix this with all
          giving the same results:

          <OL>
            <LI>
              Set the environment variable <TT>JDK_HOME</TT> to the Java
              installation directory (e.g., <TT>/usr/local/java</TT> which
              contains a <TT>bin</TT> subdirectory with all the JDK
              utilities).
            </LI>
            <LI>
              Set the environment variable <TT>JAVA_HOME</TT> to the Java
              installation directory.  This serves the same purpose as the
              previous option but offers users a different environment
              variable name to allow for varying configurations between sites
              and platforms.
            </LI>
            <LI>
              Give <TT>configure</TT> a path to the Java installation through
              the <TT>--with-jdkhome</TT> option.
            </LI>
          </OL>

          Note that in a Win32 environment, the path separator character
          should be a `<TT>/</TT>' rather than a `<TT>\</TT>'.  This is
          consistent with other uses of paths in a Win32 environment.
        </LI>
      </UL>
    </P>

  <H5>Options</H5>

    <P>
      The following is a list of the current Juggler-specific options that
      can be invoked at configuration time as of Revision ${CONFIGURE_REV}
      of <TT>configure.in</TT> (the revision number can be found at the top
      of the <TT>configure.in</TT> file and at the top of the configure
      script).  The output for all options is generated by doing
      <TT><B>configure --help</B></TT>.

      <DL>
        <DT><TT>--with-gcc</TT>
          <DD>Force the use of GCC as the compiler.  Currently as of
              Revision ${CONFIGURE_REV} of <TT>configure.in</TT>), use of
              this option is not fully implemented.  Its current state is
              for use only in a Win32 environment so that the Cygnus-Win32
              version of GCC can be used to compile Juggler instead of
              the Microsoft Visual C++ command-line compiler.
        <DT><TT>--with-abi=&lt;OPT&gt;</TT>
          <DD>Define the application binary interface (ABI) for which
              Juggler is compiled.  In some cases, the instruction set
              architecture (ISA) can also be defined in combination with
              the ABI.  The possible values for this are:

              <UL>
                <LI>
                  <TT>O32</TT> (<B>IRIX</B>): Use the old 32-bit ABI (the
                  <TT>-32</TT> compiler option with the MIPSpro compilers).
                  This is currently not supported and is not likely to be
                  supported.
                </LI>
                <LI>
                  <TT>N32_M3</TT> (<B>IRIX</B>): Use the new 32-bit ABI and
                  the mips3 ISA (using MIPSpro compiler options <TT>-n32
                  -mips3</TT>.  <I>This is the default for building on
                  IRIX.</I>
                </LI>
                <LI>
                  <TT>N32_M4</TT> (<B>IRIX</B>): Use the new 32-bit ABI and
                  the mips4 ISA (using MIPSpro compiler options <TT>-n32
                  -mips4</TT>.
                </LI>
                <LI>
                  <TT>64_M3</TT> (<B>IRIX</B>): Use the 64-bit ABI and the
                  mips3 ISA (using MIPSpro compiler options <TT>-64
                  -mips4</TT>.
                </LI>
                <LI>
                  <TT>64_M4</TT> (<B>IRIX</B>): Use the 64-bit ABI and the
                  mips4 ISA (using MIPSpro compiler options <TT>-n32
                  -mips4</TT>.
                </LI>
                <LI>
                  <TT>ELF_i386</TT> (<B>Linux, Solaris, FreeBSD, NetBSD</B>):
                  Use the ELF ABI on x86 hardware.  This uses the default
                  ABI and ISA when compiling on the i386 versions of the
                  named operating systems.  Other ISA's may work but have
                  not been tested.  For other architectures, let the
                  configure script figure out the ISA based on what it
                  determines the target platform to be.  <I>This is the
                  default option for the named operating systems.</I>
                </LI>
                <LI>
                  <TT>WIN32_i386</TT> (<B>Windows NT, Windows 9x</B>): Use
                  the standard Win32 ABI on x86 hardware.  This uses the
                  default settings for compiling in these environments.  No
                  support is planned for other architectures.  <I>This is
                  the default option for the named operating systems.</I>
                </LI>
                <LI>
                  <TT>HP</TT> (<B>HP-UX</B>): Use the HP PA-RISC ABI.  This
                  will be supported in the future when the HP-UX port is
                  functional.  <I>This is the default for building on
                  HP-UX.</I>
                </LI>
                <LI>
                  <TT>ALPHA</TT> (<B>Digital UNIX</B>): Use the standard
                  Digital UNIX COFF ABI.  This will be supported in the
                  future if a port to Digital UNIX is made.
                </LI>
              </UL>

        <DT><TT>--with-threads=&lt;OPT&gt;</TT>
          <DD>Define the threading implementation.  The options are
              IRIX_SPROC (use IRIX <I>sproc</I>(2) threads), POSIX (use
              pthreads) and WIN32 (use Win32 threads).  The default is
              IRIX_SPROC, though <TT>configure</TT> knows what other
              platforms should use.  For example, POSIX threads are used
              on Linux, Solaris and FreeBSD without specifying this option.
        <DT><TT>--with-jdkhome=&lt;PATH&gt;</TT>
          <DD>Give the JDK installation directory.  This is the base
              directory containing a <TT>bin</TT> subdirectory with all the
              JDK utilities (such as <TT>javac</TT> and <TT>jar</TT>).
              <I>The default is </TT>/usr/java</TT>.</I>  In a Win32
              environment, this option must be give using <TT>/</TT>'s as
              the path separator rather than <TT>\</TT>'s.
        <DT><TT>--with-pfroot=&lt;PATH&gt;</TT>
          <DD>Give the IRIS Performer installation directory.  This is
              the base directory containing an <TT>include</TT> subdirectory
              that in turn has a <TT>Performer</TT> subdirectory and at
              least a <TT>lib</TT> directory with the Performer libraries.
              On IRIX, there may also be a <TT>lib32</TT> subdirectory and a
              <TT>lib64</TT> subdirectory.  They will be used appropriately
              depending on the ABI chosen (see above).  <I>The default path
              is <TT>/usr</TT>.</I>
        <DT><TT>--with-oglroot=&lt;PATH&gt;</TT>
          <DD>Give the OpenGL installation directory.  This is the base
              directory containing an <TT>include</TT> subdirectory that in
              turn has a <TT>GL</TT> subdirectory and at least a <TT>lib</TT>
              directory with the OpenGL libraries.  On IRIX, there may also
              be a <TT>lib32</TT> subdirectory and a <TT>lib64</TT>
              subdirectory.  They will be used appropriately depending on
              the ABI chosen (see above).  This option is particularly
              useful (i.e., necessary) on platforms such as Linux, FreeBSD
              and HP-UX where OpenGL is not distributed as part of the base
              operating system.  Common values are <TT>/usr/local</TT>,
              <TT>/usr/X11R6</TT> and <TT>/opt/graphics/OpenGL</TT> (HP-UX
              10.20).  As of Revision ${CONFIGURE_REV} of
              <TT>configure.in</TT>, this option is not yet supported in a
              Win32 environment.  <I>The default path is <TT>/usr</TT>.</I>
        <DT><TT>--with-perl=&lt;PATH&gt;</TT>
          <DD>Name the directory containing a Perl 5.004 or newer binary.
              A working Perl 5.004 or newer binary is necessary for a
              complete build and install of Juggler.  The version of the
              binary can be determined by executing (<TT><B>perl -v</B></TT>).
              This path is the full path leading up to the binary
              (e.g., <TT>/usr/local/bin</TT>).  There is no default, but
              common values are hard-coded into the configure script.  They
              are <TT>/usr/bin</TT>, <TT>/usr/local/bin</TT> and
              <TT>C:/Perl/bin</TT>.  Note that in a Win32 environment,
              paths must be given using <TT>/</TT>'s as the path separator
              rather than <TT>\</TT>'s.
        <DT><TT>--with-install-group=&lt;NAME&gt;</TT>
          <DD>Name the group used for ownership of installed files.  This
              allows installation of Juggler under a group name controlled
              by the site administrator.  If the group name is not found,
              no group is specified during installation which is typically
              fine.  <I>The default is ``vrjuggler''.</I>
        <DT><TT>--with-file-perms=&lt;FILE PERMISSIONS&gt;</TT>
          <DD>Provide permissions for installed (normal) files.  This will
              be used for header files, source code, config files, etc.
              The format must be UNIX octal-style (e.g., 0644).  <I>The
              default is 0644.</I>
        <DT><TT>--with-exec-perms=&lt;EXEC PERMISSIONS&gt;</TT>
          <DD>Provide permissions for installed executable files.  This
              will be used for scripts, executables and shared libraries.
              The format must be UNIX octal-style (e.g., 0644).  <I>The
              default is 0755.</I>
        <DT><TT>--with-dir-perms=&lt;DIR PERMISSIONS&gt;</TT>
          <DD>Provide permissions for directories created in the
              installation tree.  This option is not currently used for
              anything but may be used in the future for <TT>mtree</TT>
              directory specification files.  <I>The default is 0755.</I>
        <DT><TT>--enable-gl-api</TT>
          <DD>Enable the OpenGL API in the library.  <I>This option cannot be
              disabled and is on by default.</I>
        <DT><TT>--enable-pf-api</TT>
          <DD>Enable (or disable) the Performer API in the library.  This
              turns on (or turns off) compiling of the Performer code in
              VR Juggler.  Disabling is done using the standard method for
              Autoconf-generated scripts.  On platforms that do not have
              Performer, a warning is issued and the API is disabled.
              <I>This option is enabled by default.</I>
        <DT><TT>--enable-performance=&lt;OPT&gt;</TT>
          <DD>Enable (or disable) the performance-testing code.  This
              defines which method of performance testing should be used or
              disables it altogether.  The possible options are as follows:

              <UL>
                <LI>
                  <TT>SGI</TT>: Use SGI-specific methods for doing
                  performance testing.
                </LI>
                <LI>
                  <TT>POSIX</TT>: Use portable POSIX-specified code for
                  performance testing.
                </LI>
                <LI>
                  <TT>NONE</TT>: Disable performance code
                </LI>
              </UL>

              Disabling this code can be done using the <TT>NONE</TT> option
              or by using the standard disable option for Autoconf-generated
              scripts.
      </DL>
    </P>

    <P>
      Another commonly used option is <TT>--prefix</TT> which is used to
      set the base directory for the installation.  In a Win32 environment,
      be sure to use <TT>/</TT>'s as the path separator rather than
      <TT>\</TT>'s to be consistent with all other paths used by
      <TT>configure</TT> and the makefiles it generates.
    </P>

  <H5>Regenerating Files</H5>

    <P>
      After running <TT>configure</TT>, one of the generated files is a
      shell script called <TT>config.status</TT>.  This script can be used
      to regenerate all the output files from their respective <TT>.in</TT>
      files without going through the entire configuration process again.
      This is useful, for example, when only a <TT>Makefile.in</TT> file
      changes without an update in the configure script.  In general, when
      any <TT>.in</TT> file (other than <TT>configure.in</TT>) changes,
      <TT>config.status</TT> can be used to quickly incorporate the
      template file changes into the generated files.
    </P>

  <H5>When to Run <TT>configure</TT> Again</H5>
  
    <P>
      The configure script should always be run after it is regenerated
      from <TT>configure.in</TT>.  Thus, whenever <TT>autoconf</TT> is
      run (see the above section titled
      <A HREF="#autoconf">Autoconf and Autoheader</A> for more
      information), the script itself should be run again to ensure that
      the latest build environment is available.
    </P>

  <H5>Advanced Use</H5>

    <P>
      The VR Juggler configure script has been designed to work in a
      multi-platform environment.  It allows Juggler to be built for
      multiple platforms using the same source tree (distributed with NFS
      for example) with all versions co-existing safely.
    </P>

    <P>
      To take advantage of this feature, make a directory somewhere for
      building the library.  This directory can go anywhere, but the
      typical location is a subdirectory of the top-level Juggler source
      tree.  (Note that on a Win32 platform, this directory MUST be a
      subdirectory of the Juggler source tree.)  It can also be called
      whatever seems appropriate.  A common name is ``<TT>build</TT>'',
      and alternate options are ``<TT>build-PLATFORM</TT>'' where
      ``PLATFORM'' is the name of the platform on which Juggler is being
      built.  Multiple build directories can exist side by side.  They
      fully separate all parts of the compile process and can be removed
      safely at the root.  After making the directory, <TT><B>cd</B></TT>
      into it and run the configure script from it.  For example, if a
      directory called <TT>build</TT> has been created as a subdirectory
      of <TT>juggler</TT>, do the following:

      <PRE>
    <B>cd build
    ../configure [options]</B>
      </PRE>

      This will run the configure script as normal but will create a full,
      unique build environment as a subdirectory of <TT>build</TT>.
    </P>

    <P>
      So the question becomes ``To <TT>build</TT> or not to <TT>build</TT>?''
      There are advantages to running <TT>configure</TT> from the top-level
      directory, and there are disadvantages to that method.  A benefit of
      the simpler method is that it provides a quick start to building
      with no in-depth knowledge of the Juggler build system necessary.
      It has a ``familiar feel'' compared to other projects that use
      Autoconf-generated scripts for configuration.  The main disadvantage
      of this method is that the generated files are ``next to'' the
      template files.  As a developer, this can and has caused confusion
      about which file to modify.  For example, it is very easy to forget
      that a quick modification to a <TT>Makefile</TT> will be destroyed
      when <TT>configure</TT> is run again if that change is not also made
      in the corresponding <TT>Makefile.in</TT>.  It is also easy to want
      to check in a generated file when only the templates should be in
      the CVS repository.
    </P>

    <P>
      Similarly, there are advantages and disadvantages to creating a
      separate build environment.  As mentioned above, building can be
      done for multiple operating systems using the same source tree.
      (This is how the NSPR API is currently built using their configure
      script.)  In addition to building for multiple operating systems, it
      is possible to easily build multiple configurations from the same
      source tree.  This is extremely useful for building different
      threading models and different ABI/ISA combinations to test changes
      in a single source tree.  Also mentioned above, the entire build
      environment can be removed from the root.  This is because all
      aspects of the build are separated from the source tree so that
      object files, makefiles, dependency files, etc. do not pollute the
      source tree.  On the other hand, this is not a typical use of a
      configure script (though it is a documented method of configuration
      in the Autoconf documentation) and is thus not familiar to users.
      It can also result in complicated paths depending on where the
      build environment is rooted and how the path to <TT>configure</TT>
      is specified.
    </P>

<A NAME="template"><H4>Template (<TT>.in</TT>) Files</H4></A>

  <H5><TT>vjDefines.h.in</TT></H5>

    <P>
      This file is the template for <TT>vjDefines.h</TT>  (the equivalent of
      <TT>config.h</TT>) which is generated by <TT> configure</TT>.  It
      provides definitions for various system-specific features that are
      available.  <TT>vjDefines.h</TT> is included by <TT>vjConfig.h</TT>
      and should not be included by any source file directly.  This file is
      generated by <TT>autoheader</TT> from <TT>configure.in</TT> and
      <TT>acconfig.h</TT> (<A HREF="#autoconf">see above</A>) and is the
      only <TT>.in</TT> file that does not use the <TT>configure</TT>
      substitution strings (<TT>@VAR_NAME@</TT>).  If modifications are
      necessary, they should be made to <TT>acconfig.h</TT>.
    </P>

  <H5><TT>Makefile.in</TT></H5>

    <P>
      There are many <TT>Makefile.in</TT>'s in the Juggler source tree.
      All are used by <TT>configure</TT> to generate the actual makefiles
      that are used for compiling and installing Juggler.  They make
      extensive use of the <TT>configure</TT> substitution strings.
      Modifications should always be made to the <TT>Makefile.in</TT> file.
      The full list of available substitutions is available near the
      bottom of <TT>configure.in</TT>.  The file <TT>Makefile.base.in</TT>
      provides most of these values as makefile variables (macros) and can
      be included by other makefiles to maximize sharing.
    </P>

  <H5>Other <TT>.in</TT> Files</H5>

    <P>
      Besides the previous examples, <TT>configure</TT> can be used to
      generate any kind of file from a <TT>.in</TT> template file.  The
      substitution strings are expanded just as they are in makefiles.  An
      example of a generated file that takes advantage of this is
      <TT>VARS.pl.in</TT>, found in the top-level directory.  It is used
      by the Perl script <TT>makefiles-gen.pl</TT> to do substitution in
      makefiles at installation time in the same manner as the configure
      script by storing the expanded strings in a Perl hash.
    </P>

</BODY>
