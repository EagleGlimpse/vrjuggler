<HTML>
<HEAD>
   <TITLE>Use of the VR Juggler configure script</TITLE>
</HEAD>

<BODY
    TEXT="#000000" BGCOLOR="#FFFFFF"
    LINK="#0000EE" VLINK="#551A8B" ALINK="#FF0000">

<DIV ALIGN="CENTER">
<H1>Configure Script Guide</H1>
</DIV>

<H3>Usage</H3>

In writing the <I>configure</I> stuff and all the accompanying template
files, I tried to mimic the current build behavior for the library. Some
things had to be changed in order to make everything work correctly though.
The following example illustrates the typical way to use the <I>configure</I>
script:

<OL>
  <LI><B><TT>cd <I>path/to/source/juggler/lib</I></TT></B></LI>
  <LI><B><TT>mkdir <I>build</I></TT></B></LI>
  <LI><B><TT>cd <I>build</I></TT></B></LI>
  <LI><B><TT>../../configure <I>--your-options-here</I></TT></B></LI>
  <LI><B><TT>make</TT></B></LI>
</OL>

Doing this results in the library object files and the library itself being
built in a subdirectory of lib that uses the same directory naming convention
currently in place. If you are building a debugging version of the library
on an SGI with <TT>-n32</TT>, the subdirectory will be <TT>DBG.N32.SGI</TT>.

<P>

If you are building a debugging or optimized version of the library,
nothing gets built in the directory named ``<TT>build</TT>'' in the above
example.  However, this is where the Makefiles for all the directories in the
source tree go. What <I>make</I>(1) will do is recursively go through the tree
rooted at ``<TT>build</TT>'' and do The Right
Thing<SUP><FONT SIZE=-2>TM</FONT></SUP> by finding the source files in
<TT>juggler/Config</TT> or <TT>juggler/Kernel</TT> for example and build the
object files in a directory given by the <TT>${OBJDIR}</TT> macro. The default
value is to build the object files in the current directory, but the recursive
calls to <I>make</I>(1) provide alternate values for the macro (i.e., the path
to <TT>DBG.N32.SGI</TT> in this case). This diagram should clarify this:

<PRE>                                       <B>Directories created by <I>configure</I>:</B>

    juggler -+-- lib -+-- DBG.N32.SGI
             |        \-- build -------\
             |                         +-- Config
             +-- Config                +-- Environment
             +-- Environment           +-- Kernel
             +-- Kernel                +-- Input -------+-- vjGlove
             +-- ...                   +-- SharedMem    +-- ...
             :                         +-- Sync         :
             :                         +-- Threads
                                       \-- test --------+-- CfgTest
                                                        +-- input
                                                        +-- ogl ------ cubes
                                                        \-- pfNav
</PRE>

The <TT>DBG.N32.SGI</TT> directory is created by <I>make</I>(1) just as
the current Makefile does. The directory ``<TT>build</TT>'' can actually
be put anywhere you want--it does not have to be a subdirectory of
<TT>lib</TT>.  However, the directory that will have all the object files will
always be in the same location. You can also call ``<TT>build</TT>'' whatever
you want. Once done building the library, the ``<TT>build</TT>'' directory
can be safely removed if so desired.

<P>

Running <I>configure</I> directly from the base <TT>juggler</TT> directory
instead of making the ``<TT>build</TT>'' directory will work fine. However,
it will blow away all the Makefiles currently in the tree with its automatically
generated copies. I will address this later.

<H3>Run-Time Options</H3>

<I>configure</I> currently has the following run-time options:
<DL>
  <DT><B>--with-threads=[SGI_IPC|POSIX]</B></DT>
    <DD>
      Define the type of threading model to use. The default is SGI IPC, but
      POSIX is used if compiling on HP-UX.
    </DD>
  <DT><B>--with-pfroot=[PATH]</B></DT>
    <DD>
      Define the root of the Performer installation. The default is
      <TT>/usr</TT>.
    </DD>
  <DT><B>--with-oglroot=[PATH]</B></DT>
    <DD>
      Define the root of the OpenGL installation. The default is <TT>/usr</TT>.
      This is particularly useful on HP-UX where the OpenGL libraries and
      header files are in <TT>/opt/graphics/OpenGL</TT>.
    </DD>
  <DT><B>--enable-c2style=[N32|32|64]</B></DT>
    <DD>
      Define the binary type. This really only applies on SGIs (for now) where
      it sets -64 or -n32 or whatever, but it can be used on other platforms
      to provide part of the name of the library's build directory. The default
      is N32.
    </DD>
  <DT><B>--enable-opengl</B></DT>
    <DD>
      Enable the OpenGL API. This is on by default. If this is enabled and the
      libraries and header files are found, the OpenGL API code in the
      <TT>Kernel</TT> directory is compiled in. This also defines
      <B><TT>VJ_API_OPENGL</TT></B> in <TT>config.h</TT>.
    </DD>
  <DT><B>--enable-perf</B></DT>
    <DD>
      Enable the Performer API. This is on by default. The same stuff holds
      true here as with the OpenGL API. It defines
      <B><TT>VJ_API_PERFORMER</TT></B> in <TT>config.h</TT>.
    </DD>
  <DT><B>--with-builddir=[PATH]</B></DT>
    <DD>
      Define the directory where the library will be built. This is not
      currently in use. However, it could prove to be useful later.
    </DD>
</DL>

<H3>What <I>configure</I> Actually Does</H3>

<TT>config.h</TT> is <TT>#include</TT>'d in all source and header files.
This file is generated in the ``<TT>build</TT>'' directory by <I>configure</I>
when it is run. In order for the compilers to find it, <TT>-I.</TT> is
added to the include path. Sample copies of it can be found at:

<PRE>
    ~patrick/samples/config.h-sgiipc
    ~patrick/samples/config.h-pthreads
</PRE>

Both of these files were generated using the default values (except for
the threading package in the pthreads copy) for SGIs.

<P>

The configure script will check the host system for the following items when
it is run:

<UL>
  <LI>A check is made for which C and C++ compilers to use. On both IRIX and
      HP-UX, use of <I>gcc</I>(1) and <I>g++</I>(1) are disallowed by forcing
      the use of the proprietary compilers that have been used for compiling
      the library. On HP-UX, use of aC++ (<I>aCC</I>(1), HP's C++ compiler that
      implements the ANSI X3J16/ISO WG21 C++ Draft Working paper) is required
      because their <I>CC</I>(1) is <I>really</I> lacking in features.
  <LI>If using POSIX threads, it makes sure that the library is there and that
      the header files are in the include path. On HP-UX, the pthreads stuff
      and re-entrant C library are combined in the cma library, so if the
      pthreads library is not found, it falls back on a check for the cma
      library. After it figures out which library to link, it determines which
      draft of the POSIX threads standard is in place (either Draft 4 or Draft
      10) by checking for <I>pthread_kill</I>(3) that is part of Draft 10 but
      not Draft 4. If the libraries or header files are not found, the
      threading implementation falls back on SGI IPC.
  <LI>If using SGI IPC, a check is made for the header file
      <TT>sys/prctl.h.</TT>
  <LI>If neither threading implementation is available, the script exits with
      an error.
  <LI>As mentioned above, if the OpenGL and/or Performer APIs are enabled, it
      checks for the basic libraries (GL and pf respectively) and header
      files.  If not found, the missing API is disabled. If the OpenGL API is
      not found, the script exits with an error.
  <LI>A check for <I>sginap</I>(2) is made. If it is not found, an
      <I>sginap</I>() CPP macro using <I>usleep</I>(2) is defined in
      config.h.
  <LI>A check for the header file <TT>sys/z8530.h</TT. is made. This a file
      that is needed by <TT>Input/vjGlove/vt_serial_io.C</TT> but only exists
      on SGIs.
  <LI>Related to the above check, a check is made for sys/stdsyms.h. This is
      a file that defines a lot of CPP macros and such (on HP-UX at least)
      so that they do not need to be defined in our source files. At present,
      this file is only included by <TT>Input/vjGlove/vt_serial_io.C</TT>.
  <LI>Miscellaneous checks are made for several header files and system calls
      that may not actually be necessary but were added when I generated a
      generic <I>configure</I> script. These can be removed easily if they are
      deemed to be unnecessary. The checks include looking for
      <TT>strings.h</TT>, <TT>fcntl.h</TT>, <I>gettimeofday</I>(3),
      <I>socket</I>(2), <I>strerror</I>(3), etc.
</UL>

<H3>Debugging</H3>

While <I>configure</I> runs, a file called <TT>config.log</TT> is constantly
update in <I>configure</I>'s working directory. When something goes wrong with
the configuration process, the first thing to do is refer to the bottom of this
file to see what was done and why it failed. Debugging the actual script is
more difficult. Refer to the documentation on
<A HREF="config_maintain.html">maintaining and updating <TT>configure.in</TT>
and <TT>Makefile.in</TT></A> for more information relating to this topic.

<H3>Miscellaneous Notes</H3>

As far as what is committed to the repository, only the template files
that are used for generating other files are checked in. This only really
matters in the base directory where <TT>configure.in</TT> is ``compiled'' to
make the <I>configure</I> script and <TT>acconfig.h</TT> is used to build a
<TT>config.h.in</TT> file. <I>configure</I> is created by running
<I>autoconf</I>(1) on <TT>configure.in</TT> and <TT>config.h.in</TT> is
created by running <I>autoheader</I>(1) on <TT>acconfig.h</TT> and
<TT>configure.in</TT>.

<P>

If strange errors occur while compiling (after running <I>configure</I>
successfully), check to make sure that all the files are in sync. The revision
number at the top of <TT>configure.in</TT> (passed as the parameter to
<I>AC_REVISION</I>) and at the top of the <I>configure</I> script must be the
same. If they are not, run <I>autoconf</I>(1) to update <I>configure</I> to be
in sync with <TT>configure.in</TT>. Also check the revision number at the top
of <TT>acconfig.h</TT> (in the line reading ``<TT>Generated from acconfig.h
($Revision x.y$)</TT>'') and at the top of <TT>config.h.in</TT>. These two
lines should be identical. If not, run <I>autoheader</I>(1) to regenerate
<TT>config.h.in</TT> from <TT>acconfig.h</TT>. What can easily happen is a new
variable could be added to the <TT>Makefile.in</TT> files that is set with
<I>configure</I>, but the revision of <I>configure</I> used will not know
about this new symbol and thus will not substitute a value for it.

</BODY>

</HTML>
